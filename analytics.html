<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Analytics - EmoBot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Top navigation */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .back-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.7;
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            background: rgba(255,255,255,0.08);
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 15px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-description {
            font-size: 12px;
            opacity: 0.6;
        }

        /* Chart section */
        .chart-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .emotion-bars {
            margin-top: 20px;
        }

        .emotion-bar-item {
            margin-bottom: 20px;
        }

        .emotion-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .emotion-bar-bg {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .emotion-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Timeline chart */
        .timeline-chart {
            margin-top: 30px;
            height: 200px;
            position: relative;
            display: flex;
            align-items: flex-end;
            gap: 10px;
            padding: 20px 0;
        }

        .timeline-bar {
            flex: 1;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px 8px 0 0;
            min-height: 20px;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .timeline-bar:hover {
            opacity: 0.8;
            transform: translateY(-5px);
        }

        .timeline-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            opacity: 0.6;
            white-space: nowrap;
        }

        /* AI insight card */
        .insight-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .insight-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
        }

        .insight-content {
            line-height: 1.8;
            font-size: 16px;
        }

        .insight-highlight {
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: bold;
        }

        /* Suggestions */
        .suggestions {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
        }

        .suggestion-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .suggestion-item:hover {
            background: rgba(255,255,255,0.08);
        }

        .suggestion-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .suggestion-text {
            flex: 1;
        }

        .suggestion-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .suggestion-description {
            font-size: 14px;
            opacity: 0.7;
            line-height: 1.6;
        }

        /* Loading animation */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 18px;
            opacity: 0.7;
            margin-bottom: 30px;
        }

        .cta-btn {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .cta-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 24px;
            }

            .stat-value {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Top navigation -->
        <div class="top-nav">
            <div>
                <h1>üìä Emotion Analytics</h1>
                <p class="subtitle">AI-powered deep emotional insights</p>
            </div>
            <a href="index.html" class="back-btn">‚Üê Back to Home</a>
        </div>

        <!-- Main content area -->
        <div id="mainContent">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div>Analyzing your emotion data...</div>
            </div>
        </div>
    </div>

    <script>
        // Wait for page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAnalytics();
        });

        async function loadAnalytics() {
            // Get emotion data
            const emotions = JSON.parse(localStorage.getItem('emotions') || '[]');
            
            if (emotions.length === 0) {
                showEmptyState();
                return;
            }

            // Simulate loading delay
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Analyze data
            const analytics = analyzeEmotions(emotions);
            
            // Generate AI insights
            const insights = await generateAIInsights(emotions, analytics);
            
            // Render page
            renderAnalytics(analytics, insights);
        }

        function analyzeEmotions(emotions) {
            const now = new Date();
            const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            // Basic statistics
            const totalRecords = emotions.length;
            const recentEmotions = emotions.filter(e => new Date(e.time) > sevenDaysAgo);
            
            // Calculate average intensity
            const avgIntensity = emotions.reduce((sum, e) => sum + (e.intensity || 50), 0) / totalRecords;
            
            // Emotion type distribution
            const emotionTypes = {};
            emotions.forEach(e => {
                const type = e.emotion_type || 'Uncategorized';
                emotionTypes[type] = (emotionTypes[type] || 0) + 1;
            });
            
            // Most common emotion
            const mostCommon = Object.entries(emotionTypes)
                .sort((a, b) => b[1] - a[1])[0];
            
            // Time distribution (last 7 days)
            const dayData = {};
            for (let i = 0; i < 7; i++) {
                const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                const dateStr = date.toLocaleDateString('en-US');
                dayData[dateStr] = 0;
            }
            
            recentEmotions.forEach(e => {
                const dateStr = new Date(e.time).toLocaleDateString('en-US');
                if (dayData[dateStr] !== undefined) {
                    dayData[dateStr]++;
                }
            });
            
            return {
                totalRecords,
                recentCount: recentEmotions.length,
                avgIntensity: Math.round(avgIntensity),
                emotionTypes,
                mostCommon,
                dayData,
                recentEmotions
            };
        }

        async function generateAIInsights(emotions, analytics) {
            const insights = {
                summary: '',
                pattern: '',
                suggestion: ''
            };
            
            // Generate summary
            if (analytics.avgIntensity > 70) {
                insights.summary = `Your average emotion intensity is <span class="insight-highlight">${analytics.avgIntensity}</span>, which is at a high level. This indicates your recent emotional experiences have been quite intense.`;
            } else if (analytics.avgIntensity > 40) {
                insights.summary = `Your average emotion intensity is <span class="insight-highlight">${analytics.avgIntensity}</span>, within normal range. Your emotional state is relatively stable.`;
            } else {
                insights.summary = `Your average emotion intensity is <span class="insight-highlight">${analytics.avgIntensity}</span>, relatively low. You may need more opportunities for emotional expression.`;
            }
            
            // Identify patterns
            if (analytics.mostCommon) {
                insights.pattern = `Recently, you've recorded <span class="insight-highlight">${analytics.mostCommon[0]}</span> emotions most frequently, ${analytics.mostCommon[1]} times.`;
            }
            
            // Trend analysis
            const recentIntensity = analytics.recentEmotions.slice(-5).reduce((sum, e) => sum + (e.intensity || 50), 0) / 5;
            const olderIntensity = analytics.recentEmotions.slice(0, 5).reduce((sum, e) => sum + (e.intensity || 50), 0) / 5;
            
            if (recentIntensity > olderIntensity + 10) {
                insights.trend = 'üìà Your emotion intensity shows an upward trend';
            } else if (recentIntensity < olderIntensity - 10) {
                insights.trend = 'üìâ Your emotion intensity shows a downward trend';
            } else {
                insights.trend = '‚û°Ô∏è Your emotional state is relatively stable';
            }
            
            return insights;
        }

        function renderAnalytics(analytics, insights) {
            const mainContent = document.getElementById('mainContent');
            
            const html = `
                <!-- Stats cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-label">Total Records</div>
                        <div class="stat-value">${analytics.totalRecords}</div>
                        <div class="stat-description">You've recorded ${analytics.totalRecords} emotions</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-label">Last 7 Days</div>
                        <div class="stat-value">${analytics.recentCount}</div>
                        <div class="stat-description">Recorded ${analytics.recentCount} times in the past week</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üí´</div>
                        <div class="stat-label">Average Intensity</div>
                        <div class="stat-value">${analytics.avgIntensity}</div>
                        <div class="stat-description">Average emotion intensity (0-100)</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üé≠</div>
                        <div class="stat-label">Primary Emotion</div>
                        <div class="stat-value" style="font-size: 24px;">${analytics.mostCommon ? analytics.mostCommon[0] : 'None'}</div>
                        <div class="stat-description">Most frequent emotion type</div>
                    </div>
                </div>

                <!-- AI insights -->
                <div class="insight-card">
                    <div class="insight-header">
                        <span style="font-size: 24px;">ü§ñ</span>
                        <h2 style="font-size: 20px;">AI Emotional Insights</h2>
                        <span class="insight-badge">Personalized Analysis</span>
                    </div>
                    <div class="insight-content">
                        <p style="margin-bottom: 15px;">${insights.summary}</p>
                        <p style="margin-bottom: 15px;">${insights.pattern}</p>
                        <p><strong>${insights.trend}</strong></p>
                    </div>
                </div>

                <!-- Emotion distribution -->
                <div class="chart-section">
                    <div class="section-title">
                        <span>üìä</span>
                        <span>Emotion Type Distribution</span>
                    </div>
                    <div class="emotion-bars">
                        ${renderEmotionBars(analytics.emotionTypes, analytics.totalRecords)}
                    </div>
                </div>

                <!-- Time trend -->
                <div class="chart-section">
                    <div class="section-title">
                        <span>üìà</span>
                        <span>Last 7 Days Recording Trend</span>
                    </div>
                    <div class="timeline-chart">
                        ${renderTimeline(analytics.dayData)}
                    </div>
                </div>

                <!-- AI suggestions -->
                <div class="suggestions">
                    <div class="section-title">
                        <span>üí°</span>
                        <span>Personalized Recommendations</span>
                    </div>
                    ${renderSuggestions(analytics)}
                </div>
            `;
            
            mainContent.innerHTML = html;
        }

        function renderEmotionBars(emotionTypes, total) {
            const colors = {
                'Joy': '#ffd93d',
                'Calm': '#6bcf7f',
                'Anxiety': '#ff6b6b',
                'Excitement': '#ff922b',
                'Melancholy': '#a8dadc',
                'Anger': '#e63946',
                'Sadness': '#457b9d'
            };
            
            return Object.entries(emotionTypes)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => {
                    const percentage = (count / total * 100).toFixed(1);
                    const color = colors[type] || '#667eea';
                    return `
                        <div class="emotion-bar-item">
                            <div class="emotion-bar-label">
                                <span>${type}</span>
                                <span>${count} times (${percentage}%)</span>
                            </div>
                            <div class="emotion-bar-bg">
                                <div class="emotion-bar-fill" style="width: ${percentage}%; background: ${color};"></div>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function renderTimeline(dayData) {
            const maxValue = Math.max(...Object.values(dayData), 1);
            
            return Object.entries(dayData)
                .reverse()
                .map(([date, count]) => {
                    const height = (count / maxValue * 100);
                    const shortDate = new Date(date).toLocaleDateString('en-US', { month: 'numeric', day: 'numeric' });
                    return `
                        <div class="timeline-bar" style="height: ${height}%;" title="${date}: ${count} records">
                            <div class="timeline-label">${shortDate}</div>
                        </div>
                    `;
                }).join('');
        }

        function renderSuggestions(analytics) {
            const suggestions = [];
            
            // Generate suggestions based on data
            if (analytics.avgIntensity > 75) {
                suggestions.push({
                    icon: 'üßò',
                    title: 'Try Meditation',
                    description: 'Your emotion intensity is high. Consider 10-15 minutes of daily meditation to help calm your mind.'
                });
            }
            
            if (analytics.recentCount < 3) {
                suggestions.push({
                    icon: '‚úçÔ∏è',
                    title: 'Increase Recording Frequency',
                    description: 'Regular emotion tracking helps you understand yourself better. Try recording at least once daily.'
                });
            }
            
            suggestions.push({
                icon: 'üåü',
                title: 'Cultivate Positive Thinking',
                description: 'Try reflecting on three things you\'re grateful for or that made you happy at the end of each day.'
            });
            
            suggestions.push({
                icon: 'üí™',
                title: 'Maintain Regular Exercise',
                description: 'Moderate exercise can effectively regulate emotions. Aim for 3-4 aerobic workouts per week.'
            });
            
            return suggestions.map(s => `
                <div class="suggestion-item">
                    <div class="suggestion-icon">${s.icon}</div>
                    <div class="suggestion-text">
                        <div class="suggestion-title">${s.title}</div>
                        <div class="suggestion-description">${s.description}</div>
                    </div>
                </div>
            `).join('');
        }

        function showEmptyState() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">üìä</div>
                    <div class="empty-text">
                        Not enough data for analysis yet<br>
                        Start recording your emotions to discover patterns
                    </div>
                    <a href="voice.html" class="cta-btn">Record Your First Emotion üé§</a>
                </div>
            `;
        }
    </script>
</body>
</html>
